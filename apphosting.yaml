build: npm run build

backend:
  id: "backend-firebase"
  root: backend
  run: npm run start
  # --- TÚTO SEKCIU PRIDÁVAME ---
  # Zmierňujeme bezpečnostné politiky, aby fungoval Firebase signInWithPopup
  headers:
    - "Cross-Origin-Opener-Policy": "same-origin-allow-popups"
    - "Cross-Origin-Embedder-Policy": "unsafe-none"
  # --- KONIEC PRIDANEJ SEKCIE ---

rewrites:
  # 1. PRAVIDLO: Všetky cesty, ktoré začínajú na /__/ (Firebase magic paths),
  # nechaj spracovať priamo App Hostingom (tým, že neurčíme backend).
  - source: "/__/**"

  # 2. PRAVIDLO: Všetky ostatné požiadavky ("/**") pošli na tvoj Express backend.
  # Ten sa už postará o API aj o servírovanie React aplikácie.
  - source: "/**"
    backend:
      id: "backend-firebase"
